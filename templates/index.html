<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIvBM1iG9q4CPY/cHBXQ4GkPp1K8VJwVG8C3xZ8ioV7Q=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="bg-gray-50 min-h-screen">
    
    <div class="container mx-auto px-4 py-12 max-w-2xl">
        <div class="text-center mb-10">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-white rounded-2xl shadow-md border-2 mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="w-12 h-12 fill-emerald-600">
                    <path d="M512.1 376.7C457 513.4 325 430.7 325 430.7C284.5 512.5 217.6 565.1 140.4 565.4C124.3 565.4 123.8 541 140.4 541C204.8 540.7 260.9 498.3 297.6 430.9C256.5 446.8 179 458.8 136 348.7C245 303.8 295.1 359.9 314.3 394.2C324.2 369.8 331.3 343.3 335.9 314.5C335.9 314.5 196.2 336.4 186.4 216.4C305.5 168.5 339 293.1 339 293.1C340.6 276.4 342.3 240.5 342.3 239.7C342.3 239.7 236 166 304.2 74.5C428.8 117.5 365.6 236.9 365.6 236.9C366.1 238.5 366.1 260.7 365.6 270.3C365.6 270.3 410.8 181.3 502 212.8C497.8 346.8 360.1 319.2 360.1 319.2C355.7 346.6 348.9 372.6 340.1 396.7C340.1 396.7 423.1 304.9 512.1 376.7z"/>
                </svg>
            </div>
            <h1 class="text-4xl font-bold text-emerald-900 mb-3">Tomato Disease Classification</h1>
            <p class="text-emerald-700 text-lg">Identify tomato diseases instantly with AI-powered analysis</p>
        </div>

        <div class="bg-white rounded-2xl shadow-lg border-2 p-8 mb-8">
            <form action="/" method="POST" enctype="multipart/form-data" id="uploadForm">

                <div class="mb-6">
                    <label class="block text-sm font-semibold text-emerald-900 mb-4">
                        Upload Plant Image
                    </label>
                    <div class="relative border-2 border-dashed border-emerald-300 rounded-xl p-10 text-center hover:border-emerald-500 hover:bg-gray-50 transition-all cursor-pointer group" onclick="document.getElementById('fileInput').click()">
                        <input type="file" name="image" id="fileInput" required class="hidden" accept="image/*" onchange="displayFileName(this)">
                        <div class="flex flex-col items-center pointer-events-none">
                            <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mb-4 group-hover:bg-emerald-200 transition-colors">
                                <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                            </div>
                            <p class="text-base text-emerald-900 mb-2">
                                <span class="font-semibold">Click to upload</span> or drag and drop
                            </p>
                            <p class="text-sm text-emerald-600">PNG, JPG, JPEG up to 10MB</p>
                            <div id="fileNameContainer" class="mt-4 hidden">
                                <div class="inline-flex items-center space-x-2 bg-white px-4 py-2 rounded-lg border-2">
                                    <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    <p id="fileName" class="text-sm text-emerald-800 font-medium"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-emerald-600 text-white py-4 px-6 rounded-xl font-semibold hover:bg-emerald-700 transition-all focus:outline-none focus:ring-4 focus:ring-emerald-300 shadow-md">
                    Analyze Image
                </button>
            </form>
        </div>

        <div id="loadingDialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full border-2 border-emerald-200">
                <div class="text-center">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4">
                        <svg class="animate-spin h-8 w-8 text-emerald-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-emerald-900 mb-2">Analyzing Image</h3>
                    <p class="text-emerald-700">Please wait while we detect the disease...</p>
                </div>
            </div>
        </div>

        {% if prediction %}
        <div class="bg-white rounded-2xl shadow-lg border-2 overflow-hidden">

            <div class="bg-white p-8">
                <img src="{{ img_path }}" alt="Uploaded plant" class="max-w-full h-auto rounded-xl mx-auto shadow-md border-2" style="max-height: 400px;">
            </div>

            <div class="p-8">
                <div class="flex items-start space-x-4 mb-6 pb-6 border-b-2 border-emerald-100">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-emerald-600 rounded-xl flex items-center justify-center shadow-md">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-sm font-semibold text-emerald-600 uppercase tracking-wide mb-2">Detection Result</h3>
                        <p class="text-3xl font-bold text-emerald-900">{{ prediction.replace('_', ' ').replace('Tomato  ', '') }}</p>
                    </div>
                </div>

                <div class="mb-2">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-semibold text-emerald-900">Confidence Level</span>
                        <span class="text-lg font-bold text-emerald-600">{{ "%.1f" | format(confidence * 100) }}%</span>
                    </div>
                    <div class="w-full bg-emerald-100 rounded-full h-3 overflow-hidden border">
                        <div class="bg-emerald-600 h-3 rounded-full transition-all duration-500":style="`width: ${confidence * 100}%`"></div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        

        {% if recommendation %}
        <div class="bg-white rounded-2xl shadow-lg border-2 p-8 mt-6">

            <h3 class="text-2xl font-bold text-emerald-900 mb-4">Treatment Recommendation</h3>
            <div class="prose prose-emerald max-w-none">
                {{ recommendation | safe }}
            </div>

        </div>
        {% endif %}

    </div>

    <script>
        function displayFileName(input) {
            const fileName = input.files[0]?.name;
            const fileNameElement = document.getElementById('fileName');
            const fileNameContainer = document.getElementById('fileNameContainer');
            if (fileName) {
                fileNameElement.textContent = fileName;
                fileNameContainer.classList.remove('hidden');
            }
        }

        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                document.getElementById('loadingDialog').classList.remove('hidden');
            }
        });
    </script>

</body>
</html>
